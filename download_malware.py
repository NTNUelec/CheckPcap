import requests
import csv

csv_file_name = "malware_md5.csv"
save_folder = "malware/"
url = 'https://www.virustotal.com/vtapi/v2/file/download'    
api_key = ""

def get_hash_list():
	hash_value_set = set()
	
	with open(csv_file_name) as csvfile:   
		rows = csv.reader(csvfile)
      
		for i, md5_value in enumerate(rows):
			if i == 0:
				continue
			
			hash_value_set.add(str(md5_value[0]))
			
	return hash_value_set
	
	
def main():	
	hash_value_set = get_hash_list()
	
	for hash_value in hash_value_set:		
		params = {'apikey': api_key, 'hash': hash_value}    
		response = requests.get(url, params=params)
		  
		downloaded_file = response.content
		
		if str(response.status_code) == "200":        
		    save_filename = save_folder + hash_value.strip() + ".exe"
		    fp = open(save_filename, "wb")
		    fp.write(downloaded_file)
		    fp.close()      
		else:
		    print("can't find: " + str(hash_value))

main()

	

